{"title":"aws ec2 인스턴스에 Jenkins 빌드 서버 구축하기","date":"2020-02-24T00:00:00.000Z","tags":["aws"],"category":"infra","body":"<blockquote>\n<p>참고</p>\n<ul>\n<li><a href=\"https://d1.awsstatic.com/Projects/P5505030/aws-project_Jenkins-build-server.pdf\">aws project jenkins build server</a></li>\n</ul>\n</blockquote>\n<h1>AWS EC2 인스턴스를 생성하기</h1>\n<h3>1. <a href=\"https://console.aws.amazon.com/ec2/\">Amazon EC2 console</a>로 이동합니다.</h3>\n<h3>2. 우측 상단의 Region을 서울로 설정합니다.</h3>\n<h3>3. 키 페어 생성하기</h3>\n<ul>\n<li>키 페어 생성 버튼을 누르면 .pem 파일 형식의 개인키를 다운로드 받을 수 있습니다. 인스턴스 생성, 연결 시 필요하므로 잘 보관해두세요.\n<img src=\"/assets/images/2020-02-24-img/1.png\" alt=\"process tree\"></li>\n</ul>\n<h3>4. EC2 인스턴스 생성</h3>\n<ol>\n<li>EC2 대시보드로 이동한 후 콘솔의 인스턴스 생성 섹션에서 인스턴스 시작을 선택하세요.\n<img src=\"/assets/images/2020-02-24-img/2.png\" alt=\"process tree\"></li>\n</ol>\n<br/>\n<ol start=\"2\">\n<li>단계 1: AMI 선택</li>\n</ol>\n<ul>\n<li>Amazon Linux AMI 프리 티어 사용 가능한 AMI를 선택하세요.\n<img src=\"/assets/images/2020-02-24-img/3.png\" alt=\"process tree\"></li>\n</ul>\n<br/>\n<ol start=\"3\">\n<li>단계 2: 인스턴스 유형 선택</li>\n</ol>\n<ul>\n<li>인스턴스 유형도 프리티어가 사용 가능한 t2.micro를 선택한 후 다음: 인스턴스 세부 정보 구성을 선택하세요.</li>\n</ul>\n<br/>\n<ol start=\"4\">\n<li>단계 3: 인스턴스 세부 정보 구성</li>\n</ol>\n<ul>\n<li>디폴트값을 그대로 사용하므로 다음:스토리지 추가를 선택하세요.</li>\n</ul>\n<br/>\n<ol start=\"5\">\n<li>단계 4: 스토리지 추가</li>\n</ol>\n<ul>\n<li>프리티어는 최대 30GB의 EBS 범용(SSD) 또는 마그네틱 스토리지를 사용할 수 있으므로 크기 항목에 8로 되어있는 것을 30으로 수정하세요. 나머지는 디폴트 값을 유지한 후, 다음:태그 추가를 클릭하세요.</li>\n</ul>\n<br/>\n<ol start=\"6\">\n<li>단계 5: 태그 추가</li>\n</ol>\n<ul>\n<li>여러 인스턴스들이 있을 경우 태그별로 구분하면 검색이나 그룹짓기 편하다고 해요.\n<img src=\"/assets/images/2020-02-24-img/4.png\" alt=\"process tree\"></li>\n</ul>\n<br/>\n<ol start=\"7\">\n<li>단계 6: 보안 그룹 구성</li>\n</ol>\n<ul>\n<li>보안그룹은 inbound와 outbound 트래픽을 인스턴스 레벨에서 컨트롤할 수 있어서 인스턴스의 <strong>방화벽</strong> 역할을 담당합니다.</li>\n<li>디폴트로 있는 SSH 유형의 소스를 내 IP로 변경하세요. SSH의 소스를 모든 IPv4(0.0.0.0/0)으로 설정하는 보안상 이유로 추천하지않기 때문입니다.</li>\n<li>HTTP, HTTPS 유형을 추가하고 소스를 0.0.0.0/0 으로 설정하면 외부 어디서든 웹 서비스에 접근할 수 있습니다.\n<img src=\"/assets/images/2020-02-24-img/5.png\" alt=\"process tree\"></li>\n</ul>\n<br/>\n<ol start=\"8\">\n<li>검토 및 시작 버튼을 클릭한 후 시작 버튼을 선택하세요.</li>\n</ol>\n<ul>\n<li>다음과 같이 기존 키 페어 선택 또는 새 키 페어 생성이 모달이 뜨게 됩니다. 위에서 my-key-pair 이름으로 키 페어를 생성해놨으니 이를 선택한 후 인스턴스 시작을 눌러줍니다.\n<img src=\"/assets/images/2020-02-24-img/6.png\" alt=\"process tree\"></li>\n</ul>\n<ol start=\"9\">\n<li>인스턴스 상태가 running이 되면 정상적으로 인스턴스 생성 및 실행이 완료된 것입니다! 끝~</li>\n</ol>\n<p><img src=\"/assets/images/2020-02-24-img/7.png\" alt=\"process tree\"></p>\n<h1>Jenkins 구축하기</h1>\n<p>방금 생성한 EC2 인스턴스에 Jenkins를 구축하겠습니다.</p>\n<h2>1. 보안 그룹 편집하기</h2>\n<blockquote>\n<p>HTTPS 프로토콜 제거와 TCP 설정을 위해 보안 그룹을 편집해야합니다.</p>\n</blockquote>\n<ol>\n<li>스크롤을 오른쪽으로 해보면 보안그룹 탭이 보입니다. 바로 밑의 링크를 클릭하여 인스턴스의 보안 그룹으로 이동하세요.\n<img src=\"/assets/images/2020-02-24-img/8.png\" alt=\"process tree\"></li>\n</ol>\n<br/>\n<ol start=\"2\">\n<li>아래 사진과 같이 EC2 인스턴스를 생성할 때 설정한 보안 그룹의 내용을 확인할 수 있습니다. 이제 편집 버튼을 눌러서 수정을 해봅시다.\n<img src=\"/assets/images/2020-02-24-img/9.png\" alt=\"process tree\"></li>\n</ol>\n<br/>\n<ol start=\"3\">\n<li>HTTPS 프로토콜은 사용하지않으므로 삭제하고 사용자 지정 TCP 규칙을 추가한 후 포트를 8080을 입력합니다.\n<img src=\"/assets/images/2020-02-24-img/10.png\" alt=\"process tree\"></li>\n</ol>\n<h2>2. 젠킨스 설치와 설정</h2>\n<h3><strong>1단계: windows10에서 ec2 인스턴스에 접속하기</strong></h3>\n<p>윈도우 10에는 openssh가 내장되어 있어 ssh 명령어를 사용할 수 있습니다. 윈도우 10에서 아래의 작업을 수행했습니다.</p>\n<ol>\n<li>my-key-pair.pem 파일이 있는 폴더로 이동합니다.</li>\n</ol>\n<pre><code>C:\\Users\\USER&gt;cd C:\\Users\\USER\\github\\project\\devrami-blog\\aws\n</code></pre>\n<ol start=\"2\">\n<li>개인키 my-key-pair.pem와 ssh 커맨드로 인스턴스에 접속합니다.</li>\n</ol>\n<pre><code>ssh -i my-key-pair.pem ec2-user@퍼블릭DNS\n</code></pre>\n<ol start=\"3\">\n<li>\n<p><strong>Are you sure you want to continue connecting\n(yes/no)?</strong> 가 뜨면 yes를 입력한 후 엔터를 누르세요.</p>\n</li>\n<li>\n<p>다음과 같은 문구를 보시면 인스턴스 연결 성공입니다.\n<img src=\"/assets/images/2020-02-24-img/11.png\" alt=\"process tree\"></p>\n</li>\n<li>\n<p>텍스트를 자세히 읽어보면 <strong>Run “sudo yum update” to apply all updates.</strong> 를 볼 수 있습니다. 다음과 같이 입력해서 빠르게 업그레이드를 수행하세요.</p>\n</li>\n</ol>\n<pre><code>sudo yum update –y\n</code></pre>\n<blockquote>\n<ul>\n<li>Yum은 RPM 기반의 시스템을 위한 자동 업데이트 겸 패키지 설치/제거 도구</li>\n<li>RPM은 원래 레드햇에서 사용되었던 패키지 파일이었지만 현재는 많은 RPM 기반 배포판(RPM 패키지, RPM 패키지 관리 도구)이 사용되고 있다. 즉, RPM을 사용하면 각종 소프트웨어의 설치 및 업데이트를 굉장히 편하게 할 수 있다.</li>\n</ul>\n</blockquote>\n<br/>\n<h3><strong>2단계: 다운로드</strong></h3>\n<ol>\n<li>yum이 어디에 젠킨스를 설치해야할지 알 수 있도록 젠킨스 레파지토리를 추가해준다.</li>\n</ol>\n<pre><code>sudo wget -O /etc/yum.repos.d/jenkins.repo http://pkg.jenkinsci.org/redhat/jenkins.repo\n</code></pre>\n<ol start=\"2\">\n<li>패키지를 설치할 수 있게 젠킨스 키 파일을 rpm에 추가한다.</li>\n</ol>\n<blockquote>\n<p>rpm 포맷은 전자서명을 첨부하여 위변조 여부를 확인할 수 있어 rpm 패키지가 위변조 되며 에러가 발생한다. 다른 제조사가 서명했는데 서명자의 검증용 키가 없을 경우도 검증이 실패하게 되는 데 이럴 경우 --import 옵션을 이용하여 검증용 키를 rpm에 추가해야한다.</p>\n</blockquote>\n<pre><code> sudo rpm --import https://pkg.jenkins.io/redhat/jenkins.io.key\n</code></pre>\n<ol start=\"3\">\n<li>젠킨스 설치하기</li>\n</ol>\n<pre><code>sudo yum install jenkins -y\n</code></pre>\n<ol start=\"4\">\n<li>젠킨스 서버 시작하기</li>\n</ol>\n<pre><code> sudo service jenkins start\n</code></pre>\n<blockquote>\n<p>다음과 같은 에러가 발생하면 자바8로 재설치해야합니다. <strong>Starting jenkins (via systemctl):  Job for jenkins.service failed because the control process exited with error code. See “systemctl status jenkins.service” and “journalctl -xe” for details.</strong></p>\n<ul>\n<li>sudo yum remove java-1.7.0-openjdk</li>\n<li>sudo yum install java-1.8.0<br>\n위 명령을 실행하고 다시 서버를 시작하면 정상적으로 구동이 될 것입니다.</li>\n</ul>\n</blockquote>\n<br/>\n<h3><strong>3단계: 젠킨스 설정</strong></h3>\n<ul>\n<li>브라우저에서 <a href=\"http://xn--DNS-z18m89ooo1b:8080\">http://퍼블릭DNS:8080</a> 로 접속하면 아래와 같은 화면이 보일 것입니다.</li>\n</ul>\n<p><img src=\"/assets/images/2020-02-24-img/12.png\" alt=\"process tree\"></p>\n<br/>\n<ul>\n<li>/var/lib/jenkins/secrets/initialAdminPassword 에 있는 패스워드를 찾은 후 Administrator password에 입력하고 continue 버튼을 클릭합니다.</li>\n</ul>\n<pre><code> sudo cat /var/lib/jenkins/secrets/initialAdminPassword\n</code></pre>\n<br/>\n<ul>\n<li>\n<p>Customize Jenkins 페이지에서 <strong>Install suggested plugins.</strong> 를 선택하여 플러그인을 설치합니다.</p>\n</li>\n<li>\n<p>설치가 완료되면 Create First Admin User 페이지에서 관리자 계정을 생성합니다.</p>\n</li>\n<li>\n<p>완료 후 이 페이지를 볼 수 있을 것입니다.<br/>\n<img src=\"/assets/images/2020-02-24-img/13.png\" alt=\"process tree\"></p>\n</li>\n</ul>\n <br/>\n<ul>\n<li>왼쪽 편에 있는 Jenkins 관리를 클릭한 후 플러그인 관리를 클릭합니다. 설치 가능 탭에서 <strong>Amazon EC2 plugin</strong>을 재시작없이 설치합니다.</li>\n</ul>\n<blockquote>\n<p>jenkins 서버에 git이 설치되어있어야 git과 연동할 수 있으므로 다음 명령어로 git을 설치해두자.</p>\n</blockquote>\n<pre><code>sudo yum install git\n</code></pre>\n","updatedAt":"2020-02-24T13:15:51.516Z"}