---
layout: post-content
title: (코딩인터뷰) 시스템 설계 및 규모 확장성 문제 3 - 웹 크롤러
date: 2019-08-30
categories: [codinginterview]
---

코딩 인터뷰 완전분석 (CRACKING THE CODING INTERVIEW 6/E) / 게일 라크만 맥도웰 지음 / 인사이트

---

# Q. 웹 크롤러 : 웹에 있는 데이터를 긁어 오는 크롤러를 설계할 때, 무한루프에 빠지는 일을 방지하려면 어떻게 해야 하는가?

## 무한루프는 어떻게 발생하는가?

단순히 웹의 링크에 의해 만들어지는 그래프로 볼 경후, 사이클이 존재하면 무한루프가 발생할 수 있다.    
따라서 무한루프를 막으려면 사이클을 탐지해야 한다.    
그러기 위해선 해시테이블을 두고 이미 방문한 페이지 v의 hash[v] 값을 true로 바꿔줘야 한다.   
이 해법은 웹을 너비 우선으로 탐색한다는 것을 의미한다.

## 페이지 v를 방문한다는 것의 의미

1. 단순히 URL 기준으로 판단해야 할까?
2. 페이지 내용에 따라 방문 여부를 확인해야 할까?

1번의 경우는 URL의 파라미타 값이 달라졌을 때 실제로 페이지는 달라지지 않을 때를 생각해야한다.    
2번의 경우 같은 페이지라 할지라도 내용이 무작위로 생성된다면 다른 페이지라고 해야하는 지를 생각해봐야한다.    
즉, 이 페이지가 저 페이지와 '다른' 페이지인지 판단하는 완벽한 방법은 없는 셈이다.

이 문제를 해결하는 방법은 페이지 내용과 URL을 토대로 페이지 간의 유사성을 가늠해 보는 것이다.

* 크롤러가 탐색해야 하는 항목들을 데이터베이스에 저장해 둔다.
* 탐색 우선순위가 가장 높은 페이지를 고른다.
* 페이지를 열어 해당 페이지의 특정한 섹션과 URL을 토대로 시그니처를 생성한다.
* 데이터베이스 쿼리를 통해 해당 시그니처의 페이지가 최근에 탐색된 적 있는지 살핀다.
* 만일 해당 시그니처를 갖는 페이지가 최근에 탐색된 적이 있으면 해당 페이지의 우선순위를 낮춰서 데이터베이스에 추가한다.
* 그렇지 않다면 해당 페이지를 탐색하고, 그 페이지에 연결된 링크를 데이터베이스에 추가한다.