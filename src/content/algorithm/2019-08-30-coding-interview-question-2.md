---
layout: post-content
title: (코딩인터뷰) 시스템 설계 및 규모 확장성 문제 2 - 소셜네트워크
date: 2019-08-30
categories: [codinginterview]
---

코딩 인터뷰 완전분석 (CRACKING THE CODING INTERVIEW 6/E) / 게일 라크만 맥도웰 지음 / 인사이트

---

# Q. 소셜 네트워크 : 페이스북이나 링크드인과 같은 대규모 소셜 네트워크를 위한 자료구조는 어떻게 설계하겠는가? 두 사람 사이의 최단 경로를 보여주는 알고리즘은 어떻게 설계하겠는가? (가령, 나->밥->수잔->제이슨->당신)

## 내풀이

'나'를 기준으로 '나'의 친구들을 연결할 필요가 있고, '친구'의 친구들을 연결할 필요가 있다.    
각 사용자를 '노드'로 정의하고 관계를 '에지'로 정의한다고 하면 자료구조로 그래프를 사용하는 게 적절하다고 생각한다.   
사용자 간의 경로 탐색은 너비우선탐색(BFS)로 하는 것이 적절하다고 생각한다.
'나'를 기준으로 동심원을 그리며 찾는 것이 깊이우선탐색(DFS)보다 낫다.
DFS는 '노드'를 기준으로 방문하지않은 노드 끝까지 갔다가 돌아가는 식으로 탐색하므로 최단경로가 아닐 수도 있다.

## 책풀이

## 단계1 : 문제를 단순화하기 - 수백만이 아닌 10명의 사용자로 생각해보기

각 사용자를 노드, 친구 관계를 간선으로 설정하여 하나의 그래프를 만들 수 있다.    
두 사용자 간의 경로는 한 사용자에서 시작해서 너비 우선 탐색을 돌려보면된다.
혹은 양방향 너비 우선 탐색을 할 수도 있다.     
하나는 출발지에서, 나머지 하나는 도착지에서 시작해서 너비 우선 탐색 두 개를 동시에 돌리는 것을 말한다.     
두 탐색이 어느 지점에서 충돌하는 순간 경로를 찾은 것이다.

**깊이우선탐색을 사용하지 않는 이유는?**     
깊이 우선 탐색은 단순히 경로 하나를 찾기 때문이고, 이 경로가 가장 짧은 경로가 아닐 수도 있다.    
또한, 경로 하나를 찾는 과정도 비효율적이다. 두 사용자가 1촌 관계라 하더라도 하위 트리에 존재하는 수백만 개의 노드를 탐색하게 될 수 있기 때문이다.

**구현방법**    
![1](/assets/images/2019-08-30-img/2-1.jpg)    <br/> 
![2](/assets/images/2019-08-30-img/2-2.jpg)     <br/>
![3](/assets/images/2019-08-30-img/2-3.jpg)     <br/>
![4](/assets/images/2019-08-30-img/2-4.jpg)     <br/>

양방향 너비 우선 탐색이 일반 너비 우선 탐색보다 빠르다.    
S와 D가 친구 C를 공유할 때, (각 사용자는 K명의 친구가 있다, q는 경로의 길이)
* 일반적인 너비 우선 탐색으로 S -> D로 가려면 대략 K + K*K개의 노드를 거쳐야 한다. = Q(K<sup>q</sup>)
* 양방향 너비 우선 탐색은 S 친구 K, D친구 K로 2K 노드만 거치면 된다. = Q(K<sup>q/2</sup>)

단, 양방향 너비 우선 탐색은 시작 지점과 도착 지점 모두 접근 가능할 때에나 사용 가능하다.

## 단계2 : 수백만 사용자의 처리

링크드인이나 페이스북 규모의 서비스를 만들 때에는 컴퓨터 하나만으로는 부족하다.    
다시 말해 Person을 위와 같이 단순하게 설계해서는 제대로 동작하지 않을 것이라는 뜻이다.     
우리가 찾는 '친구'는 같은 서버에 있지 않을 수도 있다.    
따라서 ID로 구성되는 친구 리스트를 만들고, ID를 통해 해당 사용자 정보가 있는 컴퓨터 정보를 얻는다.     
얻은 컴퓨터 정보 안에서 사용자 정보를 다시 탐색한다.    
효율적 탐색을 위해서 해시테이블을 사용한다.

**최적화하기**

* 다른 서버에 대한 탐색을 줄인다.
* 컴퓨터에 사용자 정보를 분배할 때, 무작위로 나누는 것이 아닌 사용자가 거주하는 나라나 시, 도, 군 등의 정보를 이용한다.

