---
layout: post-content
title: JVM 메모리 구조
date: 2019-10-16
tags: [java]
categories: [Java]
---

예전 면접에서 JVM 메모리 구조에 관한 질문을 받은 적이 있었다...    
횡설수설하며 대답하긴 했지만 좀 더 깔끔한 답변을 위해 정리해야할 필요성을 느꼈다..!!!    

우선, JVM이 뭘까?

JVM(Java Virtual Machine) 은 자바로 작성된 애플리케이션을 실행하기 위해서 반드시 필요한 가상머신이다!

![1](/assets/images/2019-10-16-img/memory01.png)    <br/> 

위 그림을 보면 일반 애플리케이션 코드는 OS만 거치고 하드웨어로 전달되지만 자바 애플리케이션은 JVM을 한번 더 거친다. 
그래서 자바는 속도가 느린 단점이 있다고 한다.

왜??? 이유를 알기 위해 잠시 자바 응용 프로그램의 실행되는 과정을 살펴볼 필요가 있다. 
   
1. 응용프로그램이 실행되면 JVM은 시스템으로부터 프로그램을 수행하는데 필요한 메모리를 할당받고 JVM은 이 메모리를 용도에 따라 여러 영역으로 나누어 관리한다.
2. javac.exe (자바 컴파일러)가 자바소스를 바이트 코드(*.class)로 컴파일한다.
3. Class Loader가 JVM에 클래스 파일을 로드시킨다.
4. java.exe (자바인터프리터, 실행엔진)이 컴파일된 바이트 코드를 해석한다.
5. 해석된 바이트 코드는 Runtime Data Areas에 배치되어 실행된다.

위와 같이 하드웨어에 맞게 완전히 컴파일된 상태가 아닌 바이트 코드로 컴파일된 상태고 실행 시에 해석되기 때문에 느리다. 
그래도 요즘엔 바이트 코드를 하드웨어의 기계어로 바로 변환해주는 JIT 컴파일러와 향상된 최적화 기술이 적용되어서 속도 문제가 많이 개선되었다고 한다.

장점으로는 JVM 덕분에 자바 애플리케이션은 OS에 종속되지 않는 점이 있다.    
그래도 JVM은 OS에 종속되니깐 OS에 맞는 JVM이 필요하다.

## JVM 메모리 구조

![1](/assets/images/2019-10-16-img/JvmSpec7.png)    <br/> 
[JVM스펙](https://ko.wikipedia.org/wiki/자바_가상_머신)

이 중 3가지 주요 영역에 대해 알아보자.

## 메서드 영역
메서드 영역(Method area = static area = Class area)은 JVM이 *.class을 해석하여 얻은 클래스 정보(클래스 데이터)가 저장되는 공간이다. 이 때, 클래스 변수(static 멤버변수)도 같이 저장된다.     
클래스정보에는 멤버변수의 이름/데이터 타입/접근 제어자 정보, 메소드의 이름/리턴 타입/매개변수/접근제어자 정보, 클래스인지 인터페이스인지 여부, 전체이름들이 해당된다.

## 힙
힙(Heap) 영역은 프로그램 실행 중에 생성되는 인스턴스(객체)가 저장되는 공간이다.    
즉 new 키워드로 생성된 객체와 배열을 저장한다. 물론 인스턴스 변수도 같이 저장된다.

## 호출스택
호출 스택(call stack 또는 execution stack)은 호출된 메서드를 위한 메모리가 할당되는 곳으로 이 메모리는 메서드가 작업을 수행하는 동안 지역변수(매개변수 포함), 연산의 중간 결과, 리턴 값들을 저장하는 데 사용한다. 메서드가 작업을 마치면 할당되었던 메모리 공간은 반환되어 비워진다.


참고서적) 자바의 정석    
참고블로그) [https://asfirstalways.tistory.com/158](https://asfirstalways.tistory.com/158)